// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "sqlite"
}

enum Role {
  ADMIN
  BIBLIOTECARIO
  MEMBRO
}

enum StatusLivro {
  DISPONIVEL
  EMPRESTADO
  RESERVADO
}

enum TipoMembro {
  ESTUDANTE
  PROFESSOR
}

model Usuario {
  id       Int      @id @default(autoincrement())
  nome     String
  email    String   @unique
  senha    String
  role     Role     @default(MEMBRO)
  criadoEm DateTime @default(now())

  membro Membro?
}

model Membro {
  id        Int        @id @default(autoincrement())
  matricula String     @unique
  tipo      TipoMembro
  ativo     Boolean    @default(true)
  criadoEm  DateTime   @default(now())

  usuarioId Int?     @unique
  usuario   Usuario? @relation(fields: [usuarioId], references: [id])

  emprestimos  Emprestimo[]
  reservas     Reserva[]
  historico    HistoricoLeitura[]
  chatMensagem ChatMensagem[]
}

model Livro {
  id         Int         @id @default(autoincrement())
  titulo     String
  isbn       String?     @unique
  editora    String?
  status     StatusLivro @default(DISPONIVEL)
  quantidade Int
  criadoEm   DateTime    @default(now())

  autorId     Int
  categoriaId Int

  autor     Autor     @relation(fields: [autorId], references: [id])
  categoria Categoria @relation(fields: [categoriaId], references: [id])

  emprestimos Emprestimo[]
  reservas    Reserva[]
  historico   HistoricoLeitura[]
}

model Autor {
  id   Int    @id @default(autoincrement())
  nome String

  livros Livro[]
}

model Categoria {
  id   Int    @id @default(autoincrement())
  nome String @unique

  livros Livro[]
}

model Emprestimo {
  id             Int       @id @default(autoincrement())
  dataEmprestimo DateTime  @default(now())
  dataPrevista   DateTime
  dataDevolucao  DateTime?
  renovacoes     Int       @default(0)

  membroId Int
  livroId  Int

  membro Membro @relation(fields: [membroId], references: [id])
  livro  Livro  @relation(fields: [livroId], references: [id])

  multa Multa?
}

model Reserva {
  id       Int      @id @default(autoincrement())
  ativa    Boolean  @default(true)
  posicao  Int
  paraData DateTime
  criadaEm DateTime @default(now())

  membroId Int
  livroId  Int

  membro Membro @relation(fields: [membroId], references: [id])
  livro  Livro  @relation(fields: [livroId], references: [id])
}

model Multa {
  id            Int       @id @default(autoincrement())
  valor         Float
  paga          Boolean   @default(false)
  dataPagamento DateTime?

  emprestimoId Int        @unique
  emprestimo   Emprestimo @relation(fields: [emprestimoId], references: [id])
}

model HistoricoLeitura {
  id   Int      @id @default(autoincrement())
  data DateTime @default(now())

  membroId Int
  livroId  Int

  membro Membro @relation(fields: [membroId], references: [id])
  livro  Livro  @relation(fields: [livroId], references: [id])
}

model ChatMensagem {
  id       Int      @id @default(autoincrement())
  content  String
  role     String
  criadoEm DateTime @default(now())

  membroId Int
  membro   Membro @relation(fields: [membroId], references: [id])
}
